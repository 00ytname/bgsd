<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Blogger ë‹¤ì¤‘ ë™ì˜ìƒ í¬ìŠ¤í„°</title>
</head>
<body>
  <h1>Blogger ìë™ ë™ì˜ìƒ í¬ìŠ¤í„°</h1>

  <label>ğŸ“Œ ê²Œì‹œë¬¼ ì œëª©</label><br>
  <input type="text" id="postTitle" placeholder="ì œëª© ì…ë ¥" style="width:300px;"><br><br>

  <label>ğŸ¬ ë™ì˜ìƒ ì£¼ì†Œ (ì—¬ëŸ¬ ê°œ ì¤„ë°”ê¿ˆ ì…ë ¥)</label><br>
  <textarea id="videoUrls" placeholder="í•œ ì¤„ì— í•˜ë‚˜ì”© ë¶™ì—¬ë„£ìœ¼ì„¸ìš”" rows="6" style="width:500px;"></textarea><br><br>

  <button onclick="createBloggerPost()">ğŸ“ ê²Œì‹œë¬¼ ì‘ì„±</button>

  <div id="postStatus" style="margin-top:15px; color:blue;"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const accessToken = params.get("token");

    async function getBlogId(token) {
      const res = await fetch("https://www.googleapis.com/blogger/v3/users/self/blogs", {
        headers: { Authorization: "Bearer " + token }
      });
      const data = await res.json();
      return data.items[0].id;
    }

    function generateVideoHtml(urls) {
      return urls.map(url => {
        const escaped = url.trim().replace(/&/g, "&amp;").replace(/"/g, "&quot;");
        return `<p><video src="${escaped}" autoplay="true" loop="true" height="500" controls muted></video></p>`;
      }).join("\n");
    }

    async function createBloggerPost() {
      const title = document.getElementById("postTitle").value.trim();
      const rawUrls = document.getElementById("videoUrls").value.trim();

      if (!title || !rawUrls) {
        alert("â— ì œëª©ê³¼ ë™ì˜ìƒ ì£¼ì†Œë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      if (!accessToken) {
        alert("âŒ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. login.htmlì—ì„œ ë¨¼ì € ë¡œê·¸ì¸í•˜ì„¸ìš”.");
        return;
      }

      const urlList = rawUrls.split("\n").map(line => line.trim()).filter(line => line !== "");
      const contentHtml = generateVideoHtml(urlList);

      const blogId = await getBlogId(accessToken);

      const postData = {
        title: title,
        content: contentHtml
      };

      const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/`, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + accessToken,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(postData)
      });

      const result = await res.json();

      if (result.id) {
        document.getElementById("postStatus").innerHTML =
          `âœ… ê²Œì‹œ ì„±ê³µ! <a href="${result.url}" target="_blank">ğŸ”— ê²Œì‹œë¬¼ ë³´ê¸°</a>`;
      } else {
        document.getElementById("postStatus").innerText = "âŒ ê²Œì‹œ ì‹¤íŒ¨";
        console.error(result);
      }
    }
  </script>
</body>
</html>
