<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Blogger ê¸€ì“°ê¸°</title></head>
<body>
  <h2>ì´ë¯¸ì§€ ì£¼ì†Œ ì…ë ¥ í›„ ìë™ ê²Œì‹œ</h2>

  <input id="imageUrl" placeholder="ì´ë¯¸ì§€ ì£¼ì†Œ" style="width:300px;">
  <select id="size">
    <option value="normal">ê¸°ë³¸í˜•</option>
    <option value="thumb">ì¸ë„¤ì¼</option>
    <option value="full">ì›ë³¸</option>
  </select>
  <button onclick="createBloggerPost()">ğŸ“ ê²Œì‹œí•˜ê¸°</button>

  <div id="postStatus" style="margin-top:10px;"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const accessToken = params.get("token");

    function getImageHtml(url, type) {
      if (type === "thumb") return `<img src="${url}" width="200"/>`;
      if (type === "full") return `<img src="${url}" style="max-width:100%"/>`;
      return `<img src="${url}" width="800"/>`;
    }

    async function getBlogId(token) {
      const res = await fetch("https://www.googleapis.com/blogger/v3/users/self/blogs", {
        headers: { Authorization: "Bearer " + token }
      });
      const data = await res.json();
      return data.items[0].id;
    }

    async function createBloggerPost() {
      const imageUrl = document.getElementById("imageUrl").value;
      const size = document.getElementById("size").value;
      const contentHtml = getImageHtml(imageUrl, size);
      const blogId = await getBlogId(accessToken);

      const postData = { title: "ìë™ ê²Œì‹œ", content: contentHtml };

      const res = await fetch(`https://www.googleapis.com/blogger/v3/blogs/${blogId}/posts/`, {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + accessToken,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(postData)
      });

      const result = await res.json();

      if (result.id) {
        document.getElementById("postStatus").innerHTML =
          `âœ… ê²Œì‹œ ì™„ë£Œ: <a href="${result.url}" target="_blank">[ë³´ê¸°]</a>`;
      } else {
        document.getElementById("postStatus").innerText = "âŒ ê²Œì‹œ ì‹¤íŒ¨";
      }
    }
  </script>
</body>
</html>
